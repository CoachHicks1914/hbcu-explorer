<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HBCU Campus Adventure - K-2 Activity</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', cursive, sans-serif;
            background: linear-gradient(135deg, #E31C23 0%, #000000 50%, #00843D 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 30px;
            padding: 40px;
            max-width: 1200px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            min-height: 600px;
        }

        /* Pan-African Color Variables */
        :root {
            --red: #E31C23;
            --black: #000000;
            --green: #00843D;
            --yellow: #FFD700;
        }

        /* Screen Management */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Welcome Screen */
        #welcome-screen {
            text-align: center;
        }

        .logo {
            font-size: 72px;
            margin-bottom: 20px;
        }

        h1 {
            color: var(--red);
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        h2 {
            color: var(--black);
            font-size: 32px;
            margin-bottom: 30px;
        }

        .big-button {
            background: linear-gradient(135deg, var(--red), var(--green));
            color: white;
            border: none;
            padding: 25px 50px;
            font-size: 32px;
            border-radius: 20px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 10px;
        }

        .big-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
        }

        .big-button:active {
            transform: translateY(0);
        }

        /* Storybook Styles */
        #storybook-screen {
            text-align: center;
        }

        .storybook-page {
            display: none;
            padding: 40px;
            background: linear-gradient(135deg, #FFF9E6 0%, #FFE6E6 100%);
            border-radius: 20px;
            margin: 30px 0;
            min-height: 400px;
            border: 8px solid var(--yellow);
        }

        .storybook-page.active {
            display: block;
        }

        .story-image {
            font-size: 120px;
            margin: 30px 0;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .story-text {
            font-size: 32px;
            line-height: 1.6;
            color: var(--black);
            margin: 20px 0;
            text-align: center;
        }

        .story-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 20px;
        }

        .nav-button {
            background: var(--green);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 24px;
            border-radius: 15px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            flex: 1;
        }

        .nav-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .page-indicator {
            text-align: center;
            font-size: 24px;
            color: var(--black);
            margin: 20px 0;
            font-weight: bold;
        }

        /* Campus Map Styles */
        #campus-screen h2 {
            text-align: center;
            color: var(--red);
            margin-bottom: 30px;
        }

        .instruction {
            text-align: center;
            font-size: 24px;
            color: var(--black);
            margin-bottom: 30px;
            padding: 20px;
            background: #FFF9E6;
            border-radius: 15px;
            border: 4px solid var(--yellow);
        }

        .campus-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .building {
            background: white;
            border: 6px solid var(--black);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .building:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .building.visited {
            border-color: var(--green);
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
        }

        .building-icon {
            font-size: 80px;
            margin-bottom: 15px;
        }

        .building-name {
            font-size: 24px;
            font-weight: bold;
            color: var(--black);
        }

        .checkmark {
            font-size: 40px;
            color: var(--green);
            display: none;
        }

        .building.visited .checkmark {
            display: inline-block;
        }

        /* Building Info Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 30px;
            padding: 50px;
            max-width: 600px;
            width: 100%;
            text-align: center;
            position: relative;
            border: 8px solid var(--yellow);
        }

        .modal-icon {
            font-size: 100px;
            margin-bottom: 20px;
        }

        .modal h3 {
            color: var(--red);
            font-size: 36px;
            margin-bottom: 20px;
        }

        .modal p {
            font-size: 24px;
            line-height: 1.6;
            color: var(--black);
            margin-bottom: 30px;
        }

        .close-modal {
            background: var(--green);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 24px;
            border-radius: 15px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
        }

        /* Algorithm Builder Styles */
        #algorithm-screen h2 {
            text-align: center;
            color: var(--red);
            margin-bottom: 20px;
        }

        .algorithm-instruction {
            text-align: center;
            font-size: 22px;
            color: var(--black);
            margin-bottom: 30px;
            padding: 20px;
            background: #FFF9E6;
            border-radius: 15px;
            border: 4px solid var(--yellow);
        }

        .algorithm-container {
            display: flex;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .arrow-palette {
            flex: 0 0 200px;
            background: #f5f5f5;
            border: 6px solid var(--black);
            border-radius: 20px;
            padding: 20px;
        }

        .palette-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--red);
            margin-bottom: 20px;
            text-align: center;
        }

        .arrow-option {
            background: white;
            border: 4px solid var(--black);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            cursor: grab;
            text-align: center;
            font-size: 60px;
            transition: transform 0.2s;
            user-select: none;
        }

        .arrow-option:hover {
            transform: scale(1.1);
        }

        .arrow-option:active {
            cursor: grabbing;
        }

        .campus-path {
            flex: 1;
            min-width: 300px;
        }

        .path-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .sidewalk-block {
            background: #D3D3D3;
            border: 4px solid #808080;
            border-radius: 10px;
            aspect-ratio: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 50px;
            position: relative;
            min-height: 100px;
            transition: background 0.2s;
        }

        .sidewalk-block.start {
            background: var(--green);
            border-color: var(--black);
        }

        .sidewalk-block.start::before {
            content: 'üè´';
            font-size: 60px;
        }

        .sidewalk-block.end {
            background: var(--red);
            border-color: var(--black);
        }

        .sidewalk-block.end::before {
            content: 'üéì';
            font-size: 60px;
        }

        .sidewalk-block.drop-zone {
            background: #FFF9E6;
            border-style: dashed;
        }

        .sidewalk-block.has-arrow {
            background: white;
        }

        .arrow-in-block {
            font-size: 50px;
            cursor: pointer;
            user-select: none;
        }

        .algorithm-controls {
            text-align: center;
            margin-top: 30px;
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .control-button {
            background: var(--green);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 24px;
            border-radius: 15px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .control-button.run {
            background: linear-gradient(135deg, var(--red), #FF6B6B);
        }

        .control-button.clear {
            background: #666;
        }

        .feedback {
            text-align: center;
            margin-top: 30px;
            font-size: 28px;
            font-weight: bold;
            min-height: 40px;
        }

        .feedback.success {
            color: var(--green);
        }

        .feedback.error {
            color: var(--red);
        }

        /* Progress Indicator */
        .progress-bar {
            background: #e0e0e0;
            border-radius: 20px;
            height: 30px;
            margin: 20px 0;
            overflow: hidden;
            border: 3px solid var(--black);
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--red), var(--green));
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 36px;
            }

            h2 {
                font-size: 28px;
            }

            .big-button {
                padding: 20px 30px;
                font-size: 24px;
            }

            .story-text {
                font-size: 24px;
            }

            .algorithm-container {
                flex-direction: column;
            }

            .arrow-palette {
                flex: 1;
            }

            .path-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Back Button */
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #666;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 20px;
            border-radius: 15px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="screen active">
            <div class="logo">üéì</div>
            <h1>HBCU Campus Adventure!</h1>
            <h2>For Kindergarten - 2nd Grade</h2>
            <p style="font-size: 24px; margin: 30px 0; color: #333;">
                Let's explore an HBCU campus and learn about algorithms!
            </p>
            <button class="big-button" onclick="showScreen('storybook-screen')">
                üìñ Start Adventure!
            </button>
        </div>

        <!-- Storybook Screen -->
        <div id="storybook-screen" class="screen">
            <button class="back-button" onclick="showScreen('welcome-screen')">‚Üê Back</button>
            <h1 style="text-align: center; color: var(--red);">üìñ Our HBCU Story</h1>

            <div class="page-indicator">
                Page <span id="current-page">1</span> of <span id="total-pages">6</span>
            </div>

            <!-- Story Pages -->
            <div class="storybook-page active" data-page="1">
                <div class="story-image">üè´</div>
                <p class="story-text">
                    Welcome to our HBCU campus! HBCU stands for
                    <strong>Historically Black Colleges and Universities</strong>.
                    These are special schools where students learn and grow together!
                </p>
            </div>

            <div class="storybook-page" data-page="2">
                <div class="story-image">üìö</div>
                <p class="story-text">
                    On our campus, there are many buildings where students learn amazing things.
                    They read books, do science experiments, play sports, and make new friends!
                </p>
            </div>

            <div class="storybook-page" data-page="3">
                <div class="story-image">üß™</div>
                <p class="story-text">
                    Students follow <strong>steps</strong> to get from place to place on campus.
                    Just like following a recipe to bake cookies!
                    This is called an <strong>ALGORITHM</strong>!
                </p>
            </div>

            <div class="storybook-page" data-page="4">
                <div class="story-image">‚û°Ô∏è</div>
                <p class="story-text">
                    An algorithm is a list of steps to do something.
                    Like: Walk forward ‚û°Ô∏è, turn right ‚û°Ô∏è, walk forward ‚û°Ô∏è
                    to get to the library!
                </p>
            </div>

            <div class="storybook-page" data-page="5">
                <div class="story-image">üéØ</div>
                <p class="story-text">
                    Today, YOU will explore the campus and learn to create
                    your own algorithms! You'll help a student find their way
                    around campus using arrows!
                </p>
            </div>

            <div class="storybook-page" data-page="6">
                <div class="story-image">üåü</div>
                <p class="story-text">
                    Are you ready to be a campus explorer and algorithm expert?
                    Let's go!
                </p>
            </div>

            <!-- Story Navigation -->
            <div class="story-nav">
                <button class="nav-button" id="prev-btn" onclick="previousPage()" disabled>
                    ‚¨ÖÔ∏è Previous
                </button>
                <button class="nav-button" id="next-btn" onclick="nextPage()">
                    Next ‚û°Ô∏è
                </button>
                <button class="nav-button" id="explore-btn" onclick="showScreen('campus-screen')" style="display: none;">
                    üè´ Explore Campus!
                </button>
            </div>
        </div>

        <!-- Campus Exploration Screen -->
        <div id="campus-screen" class="screen">
            <button class="back-button" onclick="showScreen('storybook-screen')">‚Üê Back</button>
            <h2>üè´ Explore the HBCU Campus!</h2>
            <p class="instruction">
                Click on each building to learn what students do there!
            </p>

            <div class="progress-bar">
                <div class="progress-fill" id="campus-progress" style="width: 0%;">0/6</div>
            </div>

            <div class="campus-grid">
                <div class="building" data-building="library" onclick="showBuilding('library')">
                    <div class="building-icon">üìö</div>
                    <div class="building-name">Library</div>
                    <div class="checkmark">‚úÖ</div>
                </div>

                <div class="building" data-building="cafeteria" onclick="showBuilding('cafeteria')">
                    <div class="building-icon">üçΩÔ∏è</div>
                    <div class="building-name">Cafeteria</div>
                    <div class="checkmark">‚úÖ</div>
                </div>

                <div class="building" data-building="stem" onclick="showBuilding('stem')">
                    <div class="building-icon">üî¨</div>
                    <div class="building-name">Science Lab</div>
                    <div class="checkmark">‚úÖ</div>
                </div>

                <div class="building" data-building="gym" onclick="showBuilding('gym')">
                    <div class="building-icon">üèÄ</div>
                    <div class="building-name">Gym</div>
                    <div class="checkmark">‚úÖ</div>
                </div>

                <div class="building" data-building="art" onclick="showBuilding('art')">
                    <div class="building-icon">üé®</div>
                    <div class="building-name">Art Room</div>
                    <div class="checkmark">‚úÖ</div>
                </div>

                <div class="building" data-building="quad" onclick="showBuilding('quad')">
                    <div class="building-icon">üå≥</div>
                    <div class="building-name">The Quad</div>
                    <div class="checkmark">‚úÖ</div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <button class="big-button" onclick="showScreen('algorithm-screen')" id="goto-algorithm">
                    ‚û°Ô∏è Build Algorithms!
                </button>
            </div>
        </div>

        <!-- Building Info Modal -->
        <div id="building-modal" class="modal">
            <div class="modal-content">
                <div class="modal-icon" id="modal-icon"></div>
                <h3 id="modal-title"></h3>
                <p id="modal-description"></p>
                <button class="close-modal" onclick="closeModal()">Got it! ‚ú®</button>
            </div>
        </div>

        <!-- Algorithm Builder Screen -->
        <div id="algorithm-screen" class="screen">
            <button class="back-button" onclick="showScreen('campus-screen')">‚Üê Back</button>
            <h2>üéØ Create Your Campus Algorithm!</h2>
            <p class="algorithm-instruction">
                <strong>Help the student get from the School üè´ to Graduation üéì!</strong><br>
                Drag arrows from the toolbox to the gray squares to show the path!
            </p>

            <div class="algorithm-container">
                <!-- Arrow Palette -->
                <div class="arrow-palette">
                    <div class="palette-title">üé® Arrow Toolbox</div>
                    <div class="arrow-option" draggable="true" data-arrow="‚¨ÜÔ∏è">‚¨ÜÔ∏è</div>
                    <div class="arrow-option" draggable="true" data-arrow="‚¨áÔ∏è">‚¨áÔ∏è</div>
                    <div class="arrow-option" draggable="true" data-arrow="‚¨ÖÔ∏è">‚¨ÖÔ∏è</div>
                    <div class="arrow-option" draggable="true" data-arrow="‚û°Ô∏è">‚û°Ô∏è</div>
                </div>

                <!-- Campus Path Grid -->
                <div class="campus-path">
                    <div class="palette-title">üö∂ Campus Sidewalk Path</div>
                    <div class="path-grid" id="path-grid">
                        <!-- Grid will be generated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Algorithm Controls -->
            <div class="algorithm-controls">
                <button class="control-button run" onclick="runAlgorithm()">
                    ‚ñ∂Ô∏è Run Algorithm!
                </button>
                <button class="control-button clear" onclick="clearAlgorithm()">
                    üóëÔ∏è Clear All
                </button>
            </div>

            <div class="feedback" id="algorithm-feedback"></div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="big-button" onclick="showScreen('completion-screen')" id="goto-completion" style="display: none;">
                    üéâ Finish Adventure!
                </button>
            </div>
        </div>

        <!-- Completion Screen -->
        <div id="completion-screen" class="screen">
            <div style="text-align: center;">
                <div style="font-size: 120px; margin: 30px 0;">üéâ</div>
                <h1 style="color: var(--red);">Amazing Work!</h1>
                <h2>You're an HBCU Campus Expert!</h2>
                <p style="font-size: 28px; margin: 30px 0; line-height: 1.6;">
                    You explored the campus and created algorithms!<br>
                    You're thinking like a computer scientist!
                </p>
                <div style="font-size: 100px; margin: 30px 0;">‚≠êüèÜ‚≠ê</div>
                <button class="big-button" onclick="resetActivity()">
                    üîÑ Explore Again!
                </button>
            </div>
        </div>
    </div>

    <script>
        // Building Information Database
        const buildingData = {
            library: {
                icon: 'üìö',
                title: 'The Library',
                description: 'Students come here to read books, study, and learn new things! The library has thousands of books about science, math, history, and stories. It\'s a quiet place where everyone can focus and discover new ideas!'
            },
            cafeteria: {
                icon: 'üçΩÔ∏è',
                title: 'The Cafeteria',
                description: 'This is where students eat yummy food and talk with friends! The cafeteria serves breakfast, lunch, and dinner. Students share meals together and make new friends. It\'s a place full of energy and fun conversations!'
            },
            stem: {
                icon: 'üî¨',
                title: 'The Science Lab',
                description: 'Students do cool experiments here! They mix chemicals, look through microscopes, and learn about how the world works. They might study plants, animals, space, or build robots. Science is all about asking questions and finding answers!'
            },
            gym: {
                icon: 'üèÄ',
                title: 'The Gymnasium',
                description: 'This is where students play sports and exercise! They play basketball, volleyball, run races, and stay healthy. The gym is also where students cheer for their school teams. Go team!'
            },
            art: {
                icon: 'üé®',
                title: 'The Art Room',
                description: 'Students create beautiful artwork here! They paint, draw, make sculptures, and express their creativity. Art helps students share their feelings and ideas in colorful ways. Every student is an artist!'
            },
            quad: {
                icon: 'üå≥',
                title: 'The Quad',
                description: 'The Quad is a big grassy area in the middle of campus! Students relax here between classes, study under trees, play games, and enjoy the sunshine. It\'s the heart of campus where everyone comes together!'
            }
        };

        // Track visited buildings
        let visitedBuildings = new Set();
        let algorithmCompleted = false;

        // Storybook Functions
        let currentPage = 1;
        const totalPages = 6;

        function updateStoryNav() {
            document.getElementById('current-page').textContent = currentPage;
            document.getElementById('prev-btn').disabled = currentPage === 1;

            if (currentPage === totalPages) {
                document.getElementById('next-btn').style.display = 'none';
                document.getElementById('explore-btn').style.display = 'block';
            } else {
                document.getElementById('next-btn').style.display = 'block';
                document.getElementById('explore-btn').style.display = 'none';
            }

            // Update active page
            document.querySelectorAll('.storybook-page').forEach(page => {
                page.classList.remove('active');
                if (parseInt(page.dataset.page) === currentPage) {
                    page.classList.add('active');
                }
            });
        }

        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                updateStoryNav();
            }
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                updateStoryNav();
            }
        }

        // Screen Management
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // Building Exploration
        function showBuilding(buildingId) {
            const building = buildingData[buildingId];
            const modal = document.getElementById('building-modal');

            document.getElementById('modal-icon').textContent = building.icon;
            document.getElementById('modal-title').textContent = building.title;
            document.getElementById('modal-description').textContent = building.description;

            modal.classList.add('active');

            // Mark as visited
            visitedBuildings.add(buildingId);
            document.querySelector(`[data-building="${buildingId}"]`).classList.add('visited');

            updateCampusProgress();
        }

        function closeModal() {
            document.getElementById('building-modal').classList.remove('active');
        }

        function updateCampusProgress() {
            const total = Object.keys(buildingData).length;
            const visited = visitedBuildings.size;
            const percentage = (visited / total) * 100;

            const progressBar = document.getElementById('campus-progress');
            progressBar.style.width = percentage + '%';
            progressBar.textContent = `${visited}/${total}`;
        }

        // Algorithm Builder
        let draggedArrow = null;
        const gridSize = 5;
        const pathGrid = document.getElementById('path-grid');

        // Initialize the path grid
        function initializePathGrid() {
            pathGrid.innerHTML = '';
            for (let i = 0; i < gridSize * gridSize; i++) {
                const block = document.createElement('div');
                block.className = 'sidewalk-block drop-zone';
                block.dataset.position = i;

                // Set start position (top-left)
                if (i === 0) {
                    block.classList.add('start');
                    block.classList.remove('drop-zone');
                }

                // Set end position (bottom-right)
                if (i === gridSize * gridSize - 1) {
                    block.classList.add('end');
                    block.classList.remove('drop-zone');
                }

                // Add drag and drop event listeners
                block.addEventListener('dragover', handleDragOver);
                block.addEventListener('drop', handleDrop);
                block.addEventListener('click', removeArrow);

                pathGrid.appendChild(block);
            }
        }

        // Drag and Drop Handlers
        document.querySelectorAll('.arrow-option').forEach(arrow => {
            arrow.addEventListener('dragstart', handleDragStart);
        });

        function handleDragStart(e) {
            draggedArrow = e.target.dataset.arrow;
            e.dataTransfer.effectAllowed = 'copy';
        }

        function handleDragOver(e) {
            if (e.target.classList.contains('drop-zone') || e.target.classList.contains('has-arrow')) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            if (draggedArrow && (e.target.classList.contains('drop-zone') || e.target.classList.contains('has-arrow'))) {
                e.target.textContent = draggedArrow;
                e.target.classList.add('has-arrow');
                e.target.classList.add('arrow-in-block');
            }
        }

        function removeArrow(e) {
            if (e.target.classList.contains('has-arrow') && !e.target.classList.contains('start') && !e.target.classList.contains('end')) {
                e.target.textContent = '';
                e.target.classList.remove('has-arrow');
                e.target.classList.remove('arrow-in-block');
            }
        }

        function clearAlgorithm() {
            document.querySelectorAll('.has-arrow').forEach(block => {
                if (!block.classList.contains('start') && !block.classList.contains('end')) {
                    block.textContent = '';
                    block.classList.remove('has-arrow');
                    block.classList.remove('arrow-in-block');
                }
            });
            document.getElementById('algorithm-feedback').textContent = '';
            document.getElementById('algorithm-feedback').className = 'feedback';
        }

        function runAlgorithm() {
            const feedback = document.getElementById('algorithm-feedback');

            // Get all blocks with arrows
            const blocks = Array.from(document.querySelectorAll('.sidewalk-block'));
            let currentPos = 0; // Start position
            const targetPos = gridSize * gridSize - 1; // End position
            let path = [currentPos];
            let success = true;

            // Simple path validation
            for (let step = 0; step < 20; step++) { // Max 20 steps to prevent infinite loop
                const currentBlock = blocks[currentPos];
                const arrow = currentBlock.textContent.trim();

                if (currentPos === targetPos) {
                    break; // Reached the end!
                }

                if (!arrow || currentBlock.classList.contains('start')) {
                    // No arrow at current position (except start)
                    if (currentBlock.classList.contains('start')) {
                        // Look for the first step
                        const nextBlock = blocks[currentPos + 1] || blocks[currentPos + gridSize];
                        if (nextBlock && nextBlock.classList.contains('has-arrow')) {
                            currentPos = parseInt(nextBlock.dataset.position);
                            path.push(currentPos);
                            continue;
                        }
                    }
                    break;
                }

                // Calculate next position based on arrow
                let nextPos = currentPos;
                switch(arrow) {
                    case '‚¨ÜÔ∏è':
                        nextPos = currentPos - gridSize;
                        break;
                    case '‚¨áÔ∏è':
                        nextPos = currentPos + gridSize;
                        break;
                    case '‚¨ÖÔ∏è':
                        nextPos = currentPos - 1;
                        break;
                    case '‚û°Ô∏è':
                        nextPos = currentPos + 1;
                        break;
                }

                // Check if move is valid
                if (nextPos < 0 || nextPos >= gridSize * gridSize) {
                    success = false;
                    break;
                }

                currentPos = nextPos;
                path.push(currentPos);
            }

            // Check if we reached the target
            if (currentPos === targetPos) {
                feedback.textContent = 'üéâ Amazing! You did it! Your algorithm works!';
                feedback.className = 'feedback success';
                algorithmCompleted = true;
                document.getElementById('goto-completion').style.display = 'inline-block';

                // Animate the path
                animatePath(path, blocks);
            } else {
                feedback.textContent = 'ü§î Not quite! Try a different path!';
                feedback.className = 'feedback error';
            }
        }

        function animatePath(path, blocks) {
            path.forEach((pos, index) => {
                setTimeout(() => {
                    blocks[pos].style.background = '#FFD700';
                    setTimeout(() => {
                        if (pos !== 0 && pos !== gridSize * gridSize - 1) {
                            blocks[pos].style.background = 'white';
                        }
                    }, 300);
                }, index * 300);
            });
        }

        function resetActivity() {
            visitedBuildings.clear();
            algorithmCompleted = false;
            currentPage = 1;

            document.querySelectorAll('.building').forEach(b => b.classList.remove('visited'));
            updateCampusProgress();
            clearAlgorithm();
            document.getElementById('goto-completion').style.display = 'none';
            updateStoryNav();

            showScreen('welcome-screen');
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            initializePathGrid();
            updateStoryNav();
            updateCampusProgress();
        });

        // Close modal when clicking outside
        document.getElementById('building-modal').addEventListener('click', (e) => {
            if (e.target.id === 'building-modal') {
                closeModal();
            }
        });
    </script>
</body>
</html>
